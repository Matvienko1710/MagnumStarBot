"use strict";(()=>{var e={};e.id=732,e.ids=[732],e.modules={1185:e=>{e.exports=require("mongoose")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6050:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d});var n={};r.r(n),r.d(n,{POST:()=>c});var a=r(9303),i=r(8716),s=r(670),o=r(7070),l=r(6039),u=r(2690);async function c(e){try{let{telegramId:t}=await e.json();if(console.log("Click API called with telegramId:",t),!t)return console.log("No telegramId provided"),o.NextResponse.json({error:"Telegram ID is required"},{status:400});let r=parseInt(t);if(isNaN(r)||r<1e8||r>999999999)return console.log("Invalid Telegram ID format:",t),o.NextResponse.json({error:"Invalid Telegram ID format"},{status:400});await l.Z;let n=await u.Z.findOne({telegramId:r});if(n?console.log("Found existing user:",{telegramId:n.telegramId,magnumCoins:n.magnumCoins,energy:n.energy}):(console.log("User not found, creating new user with telegramId:",t),n=new u.Z({telegramId:r,magnumCoins:100,stars:0,energy:100,maxEnergy:100,totalClicks:0,level:1,experience:0,experienceToNext:100,lastEnergyRestore:new Date,clickPower:1,upgrades:[],statistics:{totalEarned:0,totalSpent:0,casesOpened:0,rareItemsFound:0,daysPlayed:1,maxClickStreak:0,currentClickStreak:0,prestigeCount:0}}),await n.save(),console.log("New user created:",n)),n.energy<=0)return console.log("User has no energy left"),o.NextResponse.json({error:"No energy left"},{status:400});let a=n.clickPower;return n.magnumCoins+=a,n.stars+=1e-4,n.energy-=1,n.totalClicks+=1,n.experience+=1,n.experience>=n.experienceToNext&&(n.level+=1,n.experience=0,n.experienceToNext=Math.floor(1.2*n.experienceToNext)),n.statistics.totalEarned+=a,n.statistics.currentClickStreak+=1,n.statistics.maxClickStreak=Math.max(n.statistics.maxClickStreak,n.statistics.currentClickStreak),await n.save(),console.log("User updated:",{magnumCoins:n.magnumCoins,energy:n.energy,totalClicks:n.totalClicks,level:n.level,experience:n.experience}),o.NextResponse.json({success:!0,user:{magnumCoins:n.magnumCoins,stars:n.stars,energy:n.energy,totalClicks:n.totalClicks,level:n.level,experience:n.experience,experienceToNext:n.experienceToNext,clickPower:n.clickPower,statistics:n.statistics}})}catch(e){return console.error("Error processing click:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/click/route",pathname:"/api/click",filename:"route",bundlePath:"app/api/click/route"},resolvedPagePath:"C:\\Users\\matvi\\OneDrive\\Рабочий стол\\MagnumStarBot-1\\app\\api\\click\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:g}=m,x="/api/click/route";function y(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}},2690:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(1185),a=r.n(n);let i=new n.Schema({telegramId:{type:Number,required:!0,unique:!0},username:{type:String},firstName:{type:String},lastName:{type:String},magnumCoins:{type:Number,default:100,min:0},stars:{type:Number,default:0,min:0},energy:{type:Number,default:100,min:0},maxEnergy:{type:Number,default:100,min:1},totalClicks:{type:Number,default:0,min:0},level:{type:Number,default:1,min:1},experience:{type:Number,default:0,min:0},experienceToNext:{type:Number,default:100,min:1},lastEnergyRestore:{type:Date,default:Date.now},clickPower:{type:Number,default:1,min:1},upgrades:[{id:{type:String,required:!0},level:{type:Number,default:0,min:0}}],statistics:{totalEarned:{type:Number,default:0,min:0},totalSpent:{type:Number,default:0,min:0},casesOpened:{type:Number,default:0,min:0},rareItemsFound:{type:Number,default:0,min:0},daysPlayed:{type:Number,default:1,min:1},maxClickStreak:{type:Number,default:0,min:0},currentClickStreak:{type:Number,default:0,min:0},prestigeCount:{type:Number,default:0,min:0}}},{timestamps:!0});i.index({telegramId:1}),i.index({level:-1}),i.index({magnumCoins:-1});let s=a().models.User||a().model("User",i)},6039:(e,t,r)=>{let n;r.d(t,{Z:()=>s,N:()=>o});let a=require("mongodb");if(!process.env.MONGODB_URI)throw Error('Invalid/Missing environment variable: "MONGODB_URI"');let i=process.env.MONGODB_URI,s=n=new a.MongoClient(i,{}).connect();async function o(){return(await n).db("magnum_clicker")}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972],()=>r(6050));module.exports=n})();