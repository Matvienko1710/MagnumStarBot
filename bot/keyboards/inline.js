const { Markup } = require('telegraf');

const inlineKeyboard = (isAdmin = false) => {
  // WebApp Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½
// const webappUrl = process.env.WEBAPP_URL || 'https://magnumstarbot.onrender.com';
// console.log('WEBAPP_URL:', process.env.WEBAPP_URL);
// console.log('Using webappUrl:', webappUrl);
  
  const buttons = [
    [Markup.button.callback('ğŸ‘¤ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ', 'profile')],
    [Markup.button.callback('ğŸ Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ±Ğ¾Ğ½ÑƒÑ', 'daily_bonus')],
    [Markup.button.callback('ğŸ”‘ ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡', 'activate_key')],
    [Markup.button.callback('ğŸŒŸ Ğ’Ñ‹Ğ²ĞµÑÑ‚Ğ¸ Ğ·Ğ²ĞµĞ·Ğ´Ñ‹', 'withdraw_stars')],
    [Markup.button.callback('ğŸ‘¥ Ğ ĞµÑ„ĞµÑ€Ğ°Ğ»Ñ‹', 'referrals')]
  ];
  
  // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼
  // WebApp Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½
  if (isAdmin) {
    // buttons.push([Markup.button.webApp('ğŸŒ WebApp', webappUrl)]);
    buttons.push([Markup.button.callback('ğŸ”§ ĞĞ´Ğ¼Ğ¸Ğ½ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ', 'admin_panel')]);
  }
  
  return Markup.inlineKeyboard(buttons);
};

const inlineKeyboardWithBack = (isAdmin = false) => {
  const webappUrl = process.env.WEBAPP_URL || 'https://magnumstarbot.onrender.com';
  
  const buttons = [
    [Markup.button.callback('ğŸ‘¤ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ', 'profile')],
    [Markup.button.callback('ğŸ”‘ ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡', 'activate_key')],
    [Markup.button.callback('ğŸŒŸ Ğ’Ñ‹Ğ²ĞµÑÑ‚Ğ¸ Ğ·Ğ²ĞµĞ·Ğ´Ñ‹', 'withdraw_stars')]
  ];
  
  // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼
  // WebApp Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½
  if (isAdmin) {
    // buttons.push([Markup.button.webApp('ğŸŒ WebApp', webappUrl)]);
    buttons.push([Markup.button.callback('ğŸ”§ ĞĞ´Ğ¼Ğ¸Ğ½ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ', 'admin_panel')]);
  }
  
  // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸ Ğ² ĞºĞ¾Ğ½Ñ†Ğµ
  buttons.push([Markup.button.callback('ğŸ  Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ', 'main_menu')]);
  
  return Markup.inlineKeyboard(buttons);
};

// ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
const adminPanelKeyboard = () => {
  return Markup.inlineKeyboard([
    [Markup.button.callback('ğŸ”‘ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡', 'create_key')],
    [Markup.button.callback('â›ï¸ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡ Ğ¼Ğ°Ğ¹Ğ½ĞµÑ€Ğ°', 'create_miner_key')],
    [Markup.button.callback('ğŸ‘‘ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡ Ñ‚Ğ¸Ñ‚ÑƒĞ»Ğ°', 'create_title_key')],
    [Markup.button.callback('ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ĞºĞ»ÑÑ‡ĞµĞ¹', 'keys_stats')],
    [Markup.button.callback('ğŸ  Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ', 'main_menu')]
  ]);
};

// ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ°
const createKeyKeyboard = () => {
  return Markup.inlineKeyboard([
    [Markup.button.callback('ğŸ”™ ĞÑ‚Ğ¼ĞµĞ½Ğ°', 'admin_panel')],
    [Markup.button.callback('ğŸ  Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ', 'main_menu')]
  ]);
};

// ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ° Ñ‚Ğ¸Ñ‚ÑƒĞ»Ğ°
const createTitleKeyKeyboard = () => {
  return Markup.inlineKeyboard([
    [Markup.button.callback('ğŸ”™ ĞÑ‚Ğ¼ĞµĞ½Ğ°', 'admin_panel')],
    [Markup.button.callback('ğŸ  Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ', 'main_menu')]
  ]);
};

// ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ° Ğ¼Ğ°Ğ¹Ğ½ĞµÑ€Ğ°
const createMinerKeyKeyboard = () => {
  return Markup.inlineKeyboard([
    [Markup.button.callback('â›ï¸ ĞĞ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº (100 ğŸª™)', 'miner_key_novice')],
    [Markup.button.callback('â­ ĞŸÑƒÑ‚ÑŒ Ğº Ğ·Ğ²ĞµĞ·Ğ´Ğ°Ğ¼ (100 â­)', 'miner_key_star_path')],
    [Markup.button.callback('ğŸ”™ ĞÑ‚Ğ¼ĞµĞ½Ğ°', 'admin_panel')],
    [Markup.button.callback('ğŸ  Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ', 'main_menu')]
  ]);
};

// ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¼Ğ°Ğ¹Ğ½ĞµÑ€Ğ¾Ğ²
const minersKeyboard = () => {
  return Markup.inlineKeyboard([
    [Markup.button.callback('â›ï¸ ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ Ğ¼Ğ°Ğ¹Ğ½ĞµÑ€', 'buy_miner')],
    [Markup.button.callback('ğŸ“Š ĞœĞ¾Ğ¸ Ğ¼Ğ°Ğ¹Ğ½ĞµÑ€Ñ‹', 'my_miners')],
    [Markup.button.callback('ğŸ’ Ğ—Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹', 'collect_rewards')],
    [Markup.button.callback('ğŸ  Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ', 'main_menu')]
  ]);
};

// ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸ Ğ¼Ğ°Ğ¹Ğ½ĞµÑ€Ğ¾Ğ² (Ğ¿Ğ¾ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ğ°Ñ)
const buyMinerKeyboard = (page = 1) => {
  const { getMinerByPage, getTotalMinerPages } = require('../utils/miners');
  const miner = getMinerByPage(page);
  
  if (!miner) {
    return Markup.inlineKeyboard([
      [Markup.button.callback('ğŸ  Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ', 'main_menu')]
    ]);
  }
  
  const buttons = [
    [Markup.button.callback(`â›ï¸ ${miner.name} (${miner.price} ${miner.priceSymbol})`, `buy_${miner.id}_miner`)]
  ];
  
  // ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸
  if (miner.totalPages > 1) {
    const navButtons = [];
    
    if (page > 1) {
      navButtons.push(Markup.button.callback('â—€ï¸ ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹', `miner_page_${page - 1}`));
    }
    
    if (page < miner.totalPages) {
      navButtons.push(Markup.button.callback('Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ â–¶ï¸', `miner_page_${page + 1}`));
    }
    
    if (navButtons.length > 0) {
      buttons.push(navButtons);
    }
  }
  
  // ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸
  buttons.push([Markup.button.callback('ğŸ  Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ', 'main_menu')]);
  
  return Markup.inlineKeyboard(buttons);
};

// ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ
const profileKeyboard = (isAdmin = false) => {
  const buttons = [
    [Markup.button.callback('ğŸ‘¥ Ğ ĞµÑ„ĞµÑ€Ğ°Ğ»Ñ‹', 'referrals')],
    [Markup.button.callback('ğŸ  Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ', 'main_menu')]
  ];

  return Markup.inlineKeyboard(buttons);
};

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ñ‚Ğ¸Ñ‚ÑƒĞ»Ğ¾Ğ² ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ - Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ» ÑƒĞ±Ñ€Ğ°Ğ½ Ğ¸Ğ· Ğ±Ğ¾Ñ‚Ğ°

// ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ° Ğ·Ğ²ĞµĞ·Ğ´
const withdrawKeyboard = () => {
  return Markup.inlineKeyboard([
    [Markup.button.callback('ğŸŒŸ Ğ’Ñ‹Ğ²ĞµÑÑ‚Ğ¸ Ğ²ÑĞµ Ğ·Ğ²ĞµĞ·Ğ´Ñ‹', 'withdraw_all_stars')],
    [Markup.button.callback('ğŸ’³ Ğ£ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑƒĞ¼Ğ¼Ñƒ', 'withdraw_custom_amount')],
    [Markup.button.callback('ğŸ“Š Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ¾Ğ²', 'withdraw_history')],
    [Markup.button.callback('ğŸ  Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ', 'main_menu')]
  ]);
};

// ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ñ€ĞµÑ„ĞµÑ€Ğ°Ğ»Ğ¾Ğ²
const referralsKeyboard = () => {
  return Markup.inlineKeyboard([
    [Markup.button.callback('ğŸ”— ĞœĞ¾Ğ¹ Ñ€ĞµÑ„ĞµÑ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ´', 'my_referral_code')],
    [Markup.button.callback('ğŸ‘¥ ĞœĞ¾Ğ¸ Ñ€ĞµÑ„ĞµÑ€Ğ°Ğ»Ñ‹', 'my_referrals')],
    [Markup.button.callback('ğŸ† Ğ¢Ğ¾Ğ¿ Ñ€ĞµÑ„ĞµÑ€Ğ°Ğ»Ğ¾Ğ²', 'top_referrers')],
    [Markup.button.callback('ğŸ“ˆ Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ğ¸ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹', 'referral_levels')],
    [Markup.button.callback('ğŸ  Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ', 'main_menu')]
  ]);
};

module.exports = {
  inlineKeyboard,
  inlineKeyboardWithBack,
  adminPanelKeyboard,
  createKeyKeyboard,
  createTitleKeyKeyboard,
  createMinerKeyKeyboard,
  minersKeyboard,
  buyMinerKeyboard,
  profileKeyboard,
  withdrawKeyboard,
  referralsKeyboard
};